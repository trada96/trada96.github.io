I"º5<p>CÃ i Ä‘áº·t cÃ¡c mÃ´ hÃ¬nh pretrained cho tiáº¿ng viá»‡t nhÆ° EasyOCR, TranformerOCR, Tesseract, â€¦</p>

<div class="img-div">
    <img src="/images/blockchain/blockchain-python-newbie-1.jpg" height="700" />
</div>

<p>Trong bÃ i viáº¿t nÃ y, mÃ¬nh sáº½ giá»›i thiá»‡u vÃ  hÆ°á»›ng dáº«n cÃ i Ä‘áº·t cÃ¡c mÃ´ hÃ¬nh OCR Ä‘Æ°á»£c train sáºµn cho tiáº¿ng viá»‡t Ä‘á»ƒ má»i ngÆ°á»i
cÅ©ng nhÆ° mÃ¬nh cÃ³ thá»ƒ dá»… dÃ ng sá»­ dá»¥ng. MÃ  mÃ¬nh cÅ©ng nÃ³i trÆ°á»›c nhÃ©, cÃ¡c mÃ´ hÃ¬nh nÃ y Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ Äƒn sáºµn, nÃ³ sáº½ tá»‘t vá»›i
bá»™ dá»¯ liá»‡u giá»‘ng vá»›i bá»™ dá»¯ liá»‡u training set cá»§a há»(thÆ°á»ng lÃ  data Ä‘áº¹p ), cÃ²n náº¿u muá»‘n nÃ¢ng cao lÃªn vá»›i cÃ¡c trÆ°á»ng há»£p
áº£nh khÃ³ hÆ¡n thÃ¬ khÃ´ng cÃ³ cÃ¡ch nÃ o khÃ¡c lÃ  tá»± xÃ¢y dá»±ng riÃªng cho mÃ¬nh má»™t model OCR.</p>

<p>CÃ¡c mÃ´ hÃ¬nh mÃ¬nh sá»­ dá»¥ng sáº½ Ä‘Æ°á»£c dáº«n link á»Ÿ cuá»‘i bÃ i, náº¿u tÃ¡c giáº£ muá»‘n gá»¡ thÃ¬ hÃ£y liÃªn láº¡c vá»›i mÃ¬nh nha
(cháº¯c khÃ´ng cÃ³ Ä‘Ã¢u nhÆ°ng cá»© lo xa chÃºt :vv). ThÃ´i mÃ¬nh khÃ´ng lan man ná»¯a, báº¯t Ä‘áº§u nÃ o :)))</p>

<p>BÃ i viáº¿t cá»§a mÃ¬nh sáº½ gá»“m cÃ¡c pháº§n nhÆ° sau :</p>

<p><strong>1. OCR lÃ  gÃ¬?</strong></p>

<p><strong>2. TesseractOCR</strong></p>

<p><strong>3. EasyOCR</strong></p>

<p><strong>4. TransformerOCR (VietOCR)</strong></p>

<p><strong>5. Updating â€¦</strong></p>

<h1 id="chi-tiáº¿t-ná»™i-dung-"><strong><em>Chi tiáº¿t ná»™i dung</em></strong> :</h1>

<h2 id="1-ocr-lÃ -gÃ¬">1. OCR lÃ  gÃ¬?</h2>

<p>OCR lÃ  tá»« viáº¿t táº¯t cá»§a optical character recognition, Ä‘Æ°á»£c dá»‹ch sang tiáº¿ng viá»‡t lÃ  nháº­n diá»‡n kÃ½ tá»± quang há»c, hiá»ƒu nÃ´m
na lÃ  nÃ³ sáº½ dá»± Ä‘oÃ¡n xem áº£nh input vÃ o cÃ³ chá»©a chá»¯ gÃ¬ nhÆ° vÃ­ dá»¥ sau:</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/cmnd.png" />
</div>

<p><strong>===&gt; OUTPUT: 015071000030</strong></p>

<h3 id="á»©ng-dá»¥ng-cá»§a-ocr-lÃ -gÃ¬-">á»¨ng dá»¥ng cá»§a OCR lÃ  gÃ¬ ?</h3>

<p>á»¨ng dá»¥ng cá»§a OCR thÃ¬ nhiá»u vÃ´ ká»ƒ, miá»…n lÃ  trong áº£nh chá»©a thÃ´ng tin liÃªn quan Ä‘áº¿n text 
thÃ¬ output sáº½ lÃ  ná»™i dung cá»§a Ä‘oáº¡n text Ä‘Ã³:</p>
<ul>
  <li>Nháº­n diá»‡n thÃ´ng tin cÃ¡ nhÃ¢n tá»« chá»©ng minh nhÃ¢n dÃ¢n, tháº» cÄƒn cÆ°á»›c, báº±ng lÃ¡i xe, há»™ chiáº¿u, â€¦</li>
  <li>Äá»c giÃ¡ trá»‹ cá»§a cÃ´ng tÆ¡ Ä‘iá»‡n tá»« áº£nh chá»¥p.</li>
  <li>Nháº­n diá»‡n biá»ƒn sá»‘ xe, phÃ¡t hiá»‡n tá»« khÃ³a,..</li>
</ul>

<h2 id="2-tesseract">2. Tesseract</h2>
<p>Tesseract lÃ  á»©ng dá»¥ng OCR mÃ£ nguá»“n má»Ÿ Ä‘Æ°á»£c tÃ i trá»£ báº±ng Google. 
NÃ³ há»— trá»£ tá»‘t nháº¥t cho vÄƒn báº£n cÃ¡c vÄƒn báº£n tdf trong Ä‘iá»u kiá»‡n read-only ( KhÃ´ng thá»ƒ sao chÃ©p trá»±c tiáº¿p ná»™i dung) .
CÃ³ thá»ƒ sá»­ dá»¥ng trá»±c tiáº¿p báº±ng code hoáº·c thÃ´ng qua API.</p>

<p>Tesseract Ä‘Æ°á»£c phÃ¡t triá»ƒn Ä‘á»ƒ cháº¡y trÃªn cáº£ 3 há»‡ Ä‘iá»u hÃ nh phá»• biáº¿n hiá»‡n nay nhÆ° Window, 
Mac vÃ  Linux. NÃ³ há»— trá»£ trÃªn 100 ngÃ´n ngÅ©o gá»“m khÃ¡c nhau bao gá»“m cáº£ tiáº¿ng viá»‡t.</p>

<h3 id="21-hÆ°á»›ng-dáº«n-cÃ i-Ä‘áº·t">2.1 HÆ°á»›ng dáº«n cÃ i Ä‘áº·t</h3>

<p>MÃ¬nh sáº½ hÆ°á»›ng dáº«n cÃ i Ä‘áº·t Ä‘á»ƒ sá»­ dá»¥ng vá»›i python vÃ  linux nhÃ© cÃ¡c báº¡n:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>tesseract-ocr
</code></pre></div></div>

<div class="img-div">
    <img src="/images/ocr_pretrain/tesseract_install_1.png" />
</div>

<p>Tiáº¿p tá»¥c</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>pip <span class="nb">install </span>pytesseract
</code></pre></div></div>
<div class="img-div">
    <img src="/images/ocr_pretrain/tesseract_install_2.png" />
</div>

<p>Download <a href="https://github.com/tesseract-ocr/tessdata/blob/master/vie.traineddata">pretrained cho tiáº¿ng viá»‡t</a>
, rá»“i copy sang thÆ° má»¥c nhÆ° sau:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo cp </span>vie.traineddata /usr/share/tesseract-ocr/4.00/tessdata/
</code></pre></div></div>

<h3 id="22-thá»­-nghiá»‡m">2.2 Thá»­ nghiá»‡m</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">pytesseract</span>

<span class="c1"># Load image
</span><span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="s">'17-35-29.png'</span><span class="p">)</span>

<span class="c1"># Convert raw image -&gt; Binaray image
</span><span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
<span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">THRESH_BINARY</span> <span class="o">|</span> <span class="n">cv2</span><span class="p">.</span><span class="n">THRESH_OTSU</span><span class="p">)</span>
<span class="n">gray</span> <span class="o">=</span> <span class="n">gray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># Image To Text
</span><span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="p">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s">'vie'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p>áº¢nh Ä‘áº§u vÃ o :</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/tesseract_input.png" />
</div>

<p>Output:</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/tesseract_output.png" />
</div>

<h2 id="3-easyocr">3. EasyOCR</h2>
<p>EasyOCR lÃ  mÃ´ hÃ¬nh pretrained Ä‘Æ°á»£c há»— trá»£ vá»›i 70+ ngÃ´n ngá»¯ khÃ¡c nhau, danh sÃ¡ch ngÃ´n ngá»¯ Ä‘Æ°á»£c há»— trá»£ cÃ³ thá»ƒ xem táº¡i []
(https://www.jaided.ai/easyocr)</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/easy_ocr_pipline.jpeg" />
</div>

<h3 id="31-hÆ°á»›ng-dáº«n-cÃ i-Ä‘áº·t">3.1 HÆ°á»›ng dáº«n cÃ i Ä‘áº·t</h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>pip <span class="nb">install </span>easyocr
</code></pre></div></div>

<div class="img-div">
    <img src="/images/ocr_pretrain/easy_ocr_install.png" />
</div>

<p>LÆ°u Ã½, trong Ä‘oáº¡n code easyocr.Reader([â€˜enâ€™, â€˜viâ€™]), báº¡n cÃ³ thá»ƒ chá»n 1 hoáº·c nhiá»u hÆ¡n má»™t ngÃ´n ngá»¯ Ä‘á»ƒ phÃ¡t hiá»‡n.</p>

<h3 id="32-thá»±c-nghiá»‡m">3.2 Thá»±c nghiá»‡m</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">easyocr</span>

<span class="n">reader</span> <span class="o">=</span> <span class="n">easyocr</span><span class="p">.</span><span class="n">Reader</span><span class="p">([</span><span class="s">'en'</span><span class="p">,</span> <span class="s">'vi'</span><span class="p">])</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">readtext</span><span class="p">(</span><span class="s">'17-35-29.png'</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>

<div class="img-div">
    <img src="/images/ocr_pretrain/easy_ocr_input.png" />
</div>

<p>Káº¿t quáº£:</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/easy_ocr_output.png" />
</div>

<h2 id="4-transformerocr-vietocr">4. TransformerOCR (VietOCR)</h2>

<p>PhÆ°Æ¡ng phÃ¡p nÃ y Ä‘Æ°á»£c xÃ¢y dá»±ng tá»« tÃ¡c giáº£ Pháº¡m BÃ¡ CÆ°á»ng Quá»‘c, vÃ¬ trong blog nÃ y tÃ¡c giáº£ Ä‘Ã£ trÃ¬nh bÃ y chi tiáº¿t vá» thuáº­t toÃ¡n cÅ©ng nhÆ° so sÃ¡nh Æ°u nhÆ°á»£c Ä‘iá»ƒm vá»›i phÆ°Æ¡ng phÃ¡p AttentionOCR hay CRNN+CTC Loss rá»“i nÃªn mÃ¬nh sáº½ khÃ´ng nÃ³i láº¡i quÃ¡ nhiá»u. CÃ³ thá»ƒ hiá»ƒu Ä‘áº¡i Ã½ nhÆ° sau:</p>

<ul>
  <li>PhÆ°Æ¡ng phÃ¡p OCR thÃ´ng thÆ°á»ng lÃ  CNN + LSTM, mÃ´ hÃ¬nh cáº¯t áº£nh thÃ¬ nhiá»u pháº§n nhá» theo chiá»u dá»c, má»—i pháº§n Ä‘Ã³ Ä‘Æ°á»£c Ä‘Æ°a qua má»™t máº¡ng CNN nÃ o Ä‘Ã³ (á»Ÿ Ä‘Ã¢y tÃ¡c giáº£ dÃ¹ng VGG) Ä‘á»ƒ ra Ä‘Æ°á»£c 1 feature Ä‘áº·c trÆ°ng, rá»“i cho má»™t list feature Ä‘Ã³ qua LSTM Ä‘á»ƒ dá»± Ä‘oÃ¡n cÃ¡c kÃ­ tá»± trong áº£nh.</li>
</ul>

<div class="img-div">
    <img src="/images/ocr_pretrain/viet_ocr_pipline.jpeg" />
</div>

<ul>
  <li>PhÆ°Æ¡ng phÃ¡p TransformerOCR cáº£i tiáº¿n hÆ¡n báº±ng cÃ¡ch thay tháº¿ LSTM báº±ng má»™t mÃ´ hÃ¬nh transformer (lÃ  mÃ´ hÃ¬nh ná»n táº£ng cá»§a BERT khÃ¡ ná»•i tiáº¿ng).</li>
</ul>

<div class="img-div">
    <img src="/images/ocr_pretrain/viet_ocr_pipline_2.jpeg" />
</div>

<ul>
  <li>NgoÃ i ra phÆ°Æ¡ng phÃ¡p TransformerOCR sá»­ dá»¥ng CrossEntropyLoss thay vÃ¬ sá»­ dá»¥ng CTC Loss do phÆ°Æ¡ng phÃ¡p CTC Loss cÃ³ nhiá»u háº¡n cháº¿.</li>
</ul>

<h3 id="41-hÆ°á»›ng-dáº«n-cÃ i-Ä‘áº·t">4.1 HÆ°á»›ng dáº«n cÃ i Ä‘áº·t</h3>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">pip install vietocr==0.3.5
</span></code></pre></div></div>

<div class="img-div">
    <img src="/images/ocr_pretrain/viet_ocr_install.png" />
</div>

<h3 id="42-thá»­-nghiá»‡m">4.2 Thá»­ nghiá»‡m</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">vietocr.tool.predictor</span> <span class="kn">import</span> <span class="n">Predictor</span>
<span class="kn">from</span> <span class="nn">vietocr.tool.config</span> <span class="kn">import</span> <span class="n">Cfg</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="c1"># sá»­ dá»¥ng config cá»§a cÃ¡c báº¡n Ä‘Æ°á»£c export lÃºc train náº¿u Ä‘Ã£ thay Ä‘á»•i 
# tham sá»‘
# config = Cfg.load_config_from_file('config.yml')
# sá»­ dá»¥ng config máº·c Ä‘á»‹nh cá»§a mÃ´ hÃ¬nh
</span><span class="n">config</span> <span class="o">=</span> <span class="n">Cfg</span><span class="p">.</span><span class="n">load_config_from_name</span><span class="p">(</span><span class="s">'vgg_transformer'</span><span class="p">)</span>
<span class="c1"># Ä‘Æ°á»ng dáº«n Ä‘áº¿n trá»ng sá»‘ Ä‘Ã£ huáº¥n luyá»‡n hoáº·c comment Ä‘á»ƒ sá»­ dá»¥ng 
#pretrained model máº·c Ä‘á»‹nh
</span><span class="n">config</span><span class="p">[</span><span class="s">'weights'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'transformerocr.pth'</span>
<span class="n">config</span><span class="p">[</span><span class="s">'device'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'cpu'</span> <span class="c1"># device cháº¡y 'cuda:0', 'cuda:1', 'cpu'
</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">Predictor</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="n">img</span> <span class="o">=</span> <span class="s">'17-35-29.png'</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="c1"># dá»± Ä‘oÃ¡n 
# muá»‘n tráº£ vá» xÃ¡c suáº¥t cá»§a cÃ¢u dá»± Ä‘oÃ¡n thÃ¬ Ä‘á»•i return_prob=True
</span><span class="n">s</span> <span class="o">=</span> <span class="n">detector</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">return_prob</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'TEXT OUTPUT: '</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
</code></pre></div></div>

<div class="img-div">
    <img src="/images/ocr_pretrain/viet_ocr_input.png" />
</div>

<p>Káº¿t quáº£:</p>

<div class="img-div">
    <img src="/images/ocr_pretrain/viet_ocr_output.png" />
</div>

<p>Má»™t sá»‘ lÆ°u Ã½ tá»« tÃ¡c giáº£ :</p>
<ul>
  <li>PhÆ°Æ¡ng phÃ¡p TransformerOCR dÃ¹ Ä‘Æ°á»£c sá»­ dá»¥ng cÃ´ng nghá»‡ hiá»‡n Ä‘áº¡i nhÆ°ng chÆ°a cáº£i tiáº¿n quÃ¡ nhiá»u so vá»›i phÆ°Æ¡ng phÃ¡p SOTA trÆ°á»›c Ä‘Ã³ nhÆ° AttentionOCR mÃ  láº¡i cÃ³ thá»i gian dá»± Ä‘oÃ¡n cháº­m hÆ¡n khÃ¡ nhiá»u.</li>
  <li>Pretrained model Ä‘Æ°á»£c huáº¥n luyá»‡n vá»›i 10m áº£nh chá»¯ in nÃªn náº¿u muá»‘n sá»­ dá»¥ng trong há»‡ thá»‘ng product thá»±c táº¿ cá»§a báº¡n thÃ¬ cáº§n pháº£i training thÃªm</li>
</ul>

<h1 id="updating-">Updating â€¦</h1>

<h1 id="nguá»“n">Nguá»“n</h1>

<ul>
  <li>https://medium.datadriveninvestor.com/building-a-blockchain-in-python-f194a26530fd</li>
</ul>
:ET